<div class="row">
  <div class="col-md-12 booking-history">
    <div class="head-element">
      <h2>{{ "Payout" | translate }}</h2>
    </div>

    <div style="margin-top: 20px">
      <!-- ================= TIME RANGE + PAYOUT TABS ================= -->
      <div class="tab-buttons payout-tab">
        <!-- Time Range Tabs -->
        <div>
          <button
            class="tab-button"
            [class.active]="isAllTab"
            (click)="selectTimeRange('all')"
          >
            All
          </button>

          <button
            class="tab-button"
            [class.active]="isHourlyTab"
            (click)="selectTimeRange('hourly')"
          >
            Hourly
          </button>

          <button
            class="tab-button"
            [class.active]="isWeeklyTab"
            (click)="selectTimeRange('weekly')"
          >
            Weekly
          </button>

          <button
            class="tab-button"
            [class.active]="isDailyTab"
            (click)="selectTimeRange('daily')"
          >
            Daily
          </button>

          <button
            class="tab-button"
            [class.active]="isHistoryTab"
            (click)="selectTimeRange('history')"
          >
            Payout Downloaded History
          </button>
        </div>

        <!-- Payout Type Tabs -->
        <div>
          <button
            class="tab-button"
            [class.active]="isInitialPayoutTab"
            (click)="selectTab('initialPayout')"
          >
            {{ "InitialPayout" | translate }}
          </button>

          <button
            class="tab-button"
            [class.active]="!isInitialPayoutTab"
            (click)="selectTab('finalPayout')"
          >
            {{ "FinalPayout" | translate }}
          </button>
        </div>
      </div>

      <!-- ================= TABLE ================= -->
      <div
        class="table-container booking-manager-table"
        style="max-height: 450px; overflow-y: auto"
      >
        <table
          class="table table-responsive"
          style="width: 100%; box-shadow: none; margin: 0"
        >
          <thead
            style="position: sticky; top: 0; z-index: 1; background-color: #fff"
          >
            <tr>
              <!-- Select All -->
              <th>
                <input
                  type="checkbox"
                  [(ngModel)]="selectAll"
                  [disabled]="isHistoryTab"
                  (change)="toggleSelectAll()"
                />
              </th>

              <th>{{ "Bank name" | translate }}</th>
              <th>{{ "accountNumber" | translate }}</th>
              <th>{{ "totalAmount" | translate }}</th>
              <th>{{ "notes" | translate }}</th>
              <th>{{ "beneficiaryName" | translate }}</th>
              <th>{{ "IDCRNumber" | translate }}</th>
              <th>{{ "beneficiaryAddress" | translate }}</th>
              <th *ngIf="isHistoryTab">
                {{ "Downloaded At" | translate }}
              </th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let booking of filteredBookings">
              <!-- ================= CHECKBOX (FIXED) ================= -->
              <td *ngIf="isInitialPayoutTab">
                <input
                  type="checkbox"
                  [disabled]="isHistoryTab"
                  [(ngModel)]="booking.selectedInitial"
                />
              </td>

              <td *ngIf="!isInitialPayoutTab">
                <input
                  type="checkbox"
                  [disabled]="isHistoryTab"
                  [(ngModel)]="booking.selectedFinal"
                />
              </td>

              <!-- ================= DATA ================= -->
              <td>{{ partners[booking.partner]?.bank || "—" }}</td>
              <td>{{ partners[booking.partner]?.ibanNumber || "—" }}</td>

              <td>
                {{
                  isInitialPayoutTab
                    ? booking.initialPayout
                    : booking.finalPayout
                }}
                SAR
              </td>

              <td>
                {{
                  isInitialPayoutTab
                    ? ("Initial payment" | translate)
                    : ("Final payment" | translate)
                }}
              </td>

              <td>{{ partners[booking.partner]?.partnerName || "—" }}</td>
              <td>{{ partners[booking.partner]?.CRNumber || "—" }}</td>

              <td>
                {{ partners[booking.partner]?.region || "—" }},
                {{ partners[booking.partner]?.city || "—" }}
              </td>
              <td *ngIf="isHistoryTab">
                {{
                  isInitialPayoutTab
                    ? (booking.initialPayoutDownloadedAt
                      | date : "dd-MM-yyyy HH:mm")
                    : (booking.finalPayoutDownloadedAt
                      | date : "dd-MM-yyyy HH:mm")
                }}
              </td>
            </tr>

            <!-- ================= EMPTY STATE ================= -->
            <tr *ngIf="!filteredBookings.length">
              <td colspan="8" class="text-center text-muted py-4">
                No bookings found
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ================= ACTION BUTTON ================= -->
      <div class="d-flex justify-content-end mt-3">
        <button
          class="btn btn-payNow btn-payout"
          [disabled]="isHistoryTab"
          (click)="generatePDFOrExcel()"
        >
          <i class="fas fa-download"></i>
          {{
            isInitialPayoutTab
              ? "Processing initial amount"
              : "Processing completed amount"
          }}
        </button>
      </div>
    </div>
  </div>
</div>
